<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√Årea do Responsavel</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/preferencias-notificacao.css">
</head>
<body>
<!-- HEADER COM A ANIMA√á√ÉO CORRIGIDA -->
<header class="header">
    <div class="container">
        <!-- O link principal volta para o index.html na pasta public -->
        <a href="../public/index.html" class="logo-link" aria-label="Kanghoo - P√°gina inicial">
            <img src="../imagens/logo.png" alt="√çcone Kanghoo" class="logo-icon">
            <span class="logo-text-full">Kanghoo</span>
        </a>
        
        <nav class="nav" aria-label="Navega√ß√£o principal">
            <a href="../public/planos.html" class="nav-link">Planos</a>
            <a href="../public/index.html#contact" class="nav-link">Fale Conosco</a>
            <a href="#" class="nav-link" id="open-transport-modal">Encontrar Transporte</a>
            <a href="../public/sobre.html" class="nav-link">Sobre N√≥s</a>
        </nav>
        
        <div class="auth-buttons">
            <!-- Estando na pasta auth, o link para login √© direto -->
            <a href="login.html" class="btn btn-blue">Login</a>
            <button class="btn btn-primary" id="btn-cadastro-modal" aria-haspopup="dialog">Cadastro</button>
        </div>
    </div>
</header>
    


    <!-- Conte√∫do Principal -->
    <main class="main-content">
        <!-- Formul√°rio de Informa√ß√µes Pessoais com fundo destacado -->
        <form class="personal-info-form">
            <div class="form-header">
                <h2 class="form-title">
                    <span class="icon">üë§</span>
                    Informa√ß√µes Pessoais
                </h2>
                <span class="badge">Dados do Cadastro</span>
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="nome-completo">Nome Completo</label>
                    <input type="text" id="nome-completo" name="nome-completo" value="" readonly>
                </div>
                
                <div class="form-group">
                    <label for="dependente">Dependente</label>
                    <input type="text" id="dependente" name="dependente" value="" readonly>
                </div>
                
                <div class="form-group">
                    <label for="telefone">Telefone</label>
                    <input type="tel" id="telefone" name="telefone" value="" readonly>
                </div>
                
                <div class="form-group">
                    <label for="email">E-mail</label>
                    <input type="email" id="email" name="email" value="" readonly>
                </div>
                
                <div class="form-group">
                    <label for="endereco">Endere√ßo</label>
                    <input type="text" id="endereco" name="endereco" value="" readonly>
                </div>
                
                <div class="form-group">
                    <label for="cpf">CPF</label>
                    <input type="text" id="cpf" name="cpf" value="" readonly>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-blue" id="solicitar-edicao">
                    Solicitar Edi√ß√£o
                </button>
                <button type="button" class="btn btn-primary" id="exportar-dados">
                    Exportar Dados
                </button>
                <button type="button" class="btn btn-secondary" data-action="open-preferences">
                    üîî Prefer√™ncias de Notifica√ß√£o
                </button>
            </div>
        </form>

        <!-- Informa√ß√µes da Escola -->
        <div class="info-section">
            <h2 class="section-title">
                <span class="icon">üè¢</span>
                Escola
            </h2>
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">Localiza√ß√£o</div>
                    <div class="info-value"></div>
                </div>
                <div class="info-item">
                    <div class="info-label">Hor√°rio de Entrada</div>
                    <div class="info-value"></div>
                </div>
                <div class="info-item">
                    <div class="info-label">Hor√°rio de Sa√≠da</div>
                    <div class="info-value"></div>
                </div>
            </div>
        </div>

        <!-- Percurso -->
        <div class="info-section">
            <h2 class="section-title">
                <span class="icon">üõ£Ô∏è</span>
                Percurso
            </h2>
            <ul class="features-list">
                <li class="feature-item">Passa por rua 1</li>
                <li class="feature-item">Passa por rua 2</li>
                <li class="feature-item">Passa por Viaduto 1</li>
                <li class="feature-item">Passa por rua 3</li>
                <li class="feature-item">Chega na Escola</li>
            </ul>
            <div class="edit-section">
                <button class="edit-button" id="edit-route">
                    <span>‚úèÔ∏è</span> Editar percurso
                </button>
            </div>
        </div>

        <!-- Informa√ß√µes Adicionais -->
        <div class="info-section">
            <h2 class="section-title">
                <span class="icon">‚ÑπÔ∏è</span>
                Informa√ß√µes Adicionais
            </h2>
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">Hor√°rio de Chegada do veiculo para ida</div>
                    <div class="info-value"></div>
                </div>
                <div class="info-item">
                    <div class="info-label">Hor√°rio de Chegada do veiculo para volta</div>
                    <div class="info-value"></div>
                </div>
            </div>
        </div>
        
    </div>
    </main>
    
    <!-- RODAP√â -->
<footer id="fim" class="footer">
    <div class="container">
        <div class="footer-grid">
            <div class="footer-brand">
                <a href="../public/index.html" class="logo">Kanghoo</a>
                <p class="footer-tagline">Solu√ß√µes de viagem sem esfor√ßo.</p>
                <!-- √çcones de redes sociais podem ficar aqui para maior destaque -->
                <div class="footer-social-media">
                    <a href="#" aria-label="Facebook"><img src="../imagens/face.png" alt="Facebook"></a>
                    <a href="#" aria-label="Instagram"><img src="../imagens/insta.png" alt="Instagram"></a>
                    <a href="#" aria-label="LinkedIn"><img src="../imagens/linkedin.png" alt="LinkedIn"></a>
                </div>
            </div>

            <div class="footer-links-group">
                <h4>Transporte</h4>
                <ul>
                    <li><a href="../public/encontrar-transporte.html" onclick="setTransportType('escolar')">Transporte Escolar</a></li>
                    <li><a href="#">Rotas</a></li>
                    <li><a href="#">Monitoramento</a></li>
                    <li><a href="../public/planos.html">Pre√ßos</a></li>
                </ul>
            </div>

            <div class="footer-links-group">
                <h4>Excurs√µes</h4>
                <ul>
                    <li><a href="../public/encontrar-transporte.html" onclick="setTransportType('excursao')">Excurs√µes</a></li>
                    <li><a href="#">Fretamento</a></li>
                    <li><a href="#">Turismo</a></li>
                </ul>
            </div>

            <div class="footer-links-group">
                <h4>Empresa</h4>
                <ul>
                    <li><a href="../public/sobre.html">Sobre N√≥s</a></li>
                    <li><a href="../public/index.html#contact">Contato</a></li>
                    <li><a href="#">Carreiras</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Kanghoo. Todos os direitos reservados.</p>
        </div>
    </div>
</footer>

<script>
// Verificar autentica√ß√£o e carregar dados
document.addEventListener('DOMContentLoaded', async function() {
    const token = localStorage.getItem('authToken');
    
    if (!token) {
        // Redirecionar para login se n√£o estiver autenticado
        window.location.href = 'login.html';
        return;
    }

    try {
        // Carregar dados da crian√ßa
        const response = await fetch('/api/responsavel/crianca', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        });

        if (response.ok) {
            const result = await response.json();
            if (result.success) {
                preencherDadosCrianca(result.data);
            } else {
                console.error('Erro ao carregar dados:', result.message);
                mostrarErro('Erro ao carregar dados da crian√ßa');
            }
        } else if (response.status === 401) {
            // Token inv√°lido, redirecionar para login
            localStorage.removeItem('authToken');
            window.location.href = 'login.html';
        } else {
            console.error('Erro na requisi√ß√£o:', response.status);
            mostrarErro('Erro ao carregar dados da crian√ßa');
        }
    } catch (error) {
        console.error('Erro de conex√£o:', error);
        mostrarErro('Erro de conex√£o. Verifique sua internet.');
    }
});

// Fun√ß√£o para preencher os dados da crian√ßa na p√°gina
function preencherDadosCrianca(dados) {
    // Preencher informa√ß√µes pessoais usando IDs corretos
    const nomeCompleto = document.getElementById('nome-completo');
    if (nomeCompleto) nomeCompleto.value = dados.nome_responsavel || '';

    const dependente = document.getElementById('dependente');
    if (dependente) dependente.value = dados.nome_completo || '';

    const telefone = document.getElementById('telefone');
    if (telefone) telefone.value = dados.telefone_responsavel || '';

    const email = document.getElementById('email');
    if (email) email.value = dados.email_responsavel || '';

    const endereco = document.getElementById('endereco');
    if (endereco) endereco.value = dados.endereco_residencial || '';

    const cpf = document.getElementById('cpf');
    if (cpf) cpf.value = formatarCPF(dados.cpf) || '';

    // Preencher informa√ß√µes do transporte
    const infoValues = document.querySelectorAll('.info-value');
    if (infoValues.length >= 3) {
        infoValues[0].textContent = dados.nome_motorista || 'N√£o atribu√≠do';
        infoValues[1].textContent = 'Em movimento'; // Status padr√£o
        infoValues[2].textContent = dados.escola || '';
    }

    // Preencher informa√ß√µes adicionais se existirem
    if (infoValues.length >= 5) {
        infoValues[3].textContent = '07:30'; // Hor√°rio padr√£o de entrada
        infoValues[4].textContent = '17:30'; // Hor√°rio padr√£o de sa√≠da
    }

    // Atualizar t√≠tulo da p√°gina com nome da crian√ßa
    if (dados.nome_completo) {
        document.title = `√Årea do Respons√°vel - ${dados.nome_completo}`;
    }
}

// Fun√ß√£o para formatar CPF
function formatarCPF(cpf) {
    if (!cpf) return '';
    const numeros = cpf.replace(/\D/g, '');
    return numeros.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
}

// Fun√ß√£o para mostrar erros
function mostrarErro(mensagem) {
    // Criar elemento de erro se n√£o existir
    let errorDiv = document.getElementById('error-message');
    if (!errorDiv) {
        errorDiv = document.createElement('div');
        errorDiv.id = 'error-message';
        errorDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #f5c6cb;
            z-index: 1000;
            max-width: 300px;
        `;
        document.body.appendChild(errorDiv);
    }
    
    errorDiv.textContent = mensagem;
    errorDiv.style.display = 'block';
    
    // Auto-remover ap√≥s 5 segundos
    setTimeout(() => {
        errorDiv.style.display = 'none';
    }, 5000);
}

// Fun√ß√£o para logout
function logout() {
    localStorage.removeItem('authToken');
    localStorage.removeItem('responsavel_data');
    window.location.href = 'login.html';
}

// Adicionar evento de logout se existir bot√£o
document.addEventListener('DOMContentLoaded', function() {
    const logoutBtn = document.querySelector('[onclick*="logout"]') || document.getElementById('logout-btn');
    if (logoutBtn) {
        logoutBtn.addEventListener('click', logout);
    }
});
</script>

<script src="../js/ui-utils.js"></script>
<script>
// Melhorar a fun√ß√£o mostrarErro para usar o sistema de notifica√ß√µes
function mostrarErro(mensagem) {
    showError(mensagem);
}

// Melhorar a fun√ß√£o de carregamento de dados
document.addEventListener('DOMContentLoaded', async function() {
    // Mostrar loading da p√°gina
    const pageLoader = showPageLoading('Carregando dados...');
    
    try {
        // C√≥digo de carregamento existente...
        await new Promise(resolve => setTimeout(resolve, 500)); // Simular delay m√≠nimo
        
        // Parar loading
        pageLoader.stop();
        
        // Mostrar sucesso
        showSuccess('Dados carregados com sucesso!', 3000);
        
    } catch (error) {
        pageLoader.stop();
        showError('Erro ao carregar dados: ' + error.message);
    }
});

function setTransportType(type) {
    localStorage.setItem('transportType', type);
}
</script>

</body>
</html>