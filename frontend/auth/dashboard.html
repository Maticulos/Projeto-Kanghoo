<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carregando - Kanghoo</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body class="form-page">
    <main class="form-container">
        <h1>Redirecionando...</h1>
        <p>Por favor, aguarde.</p>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('authToken');

            // 1. Se não encontrar um token, redireciona de volta para o login.
            if (!token) {
                window.location.href = 'login.html';
                return;
            }

            try {
                // 2. Decodifica a parte do meio (payload) do token JWT para ler as informações.
                const payload = JSON.parse(atob(token.split('.')[1]));
                
                // 3. Verifica o campo "role" (que definimos como tipo_usuario no backend)
                //    e redireciona para a página correta.
                if (payload.role === 'motorista_escolar') {
                    window.location.href = 'area-motorista-escolar.html';
                } else if (payload.role === 'motorista_excursao') {
                    window.location.href = 'area-motorista-excursao.html';
                } else {
                    // Caso o usuário tenha uma role desconhecida, avisa e desloga.
                    alert('Tipo de usuário não reconhecido!');
                    localStorage.removeItem('authToken');
                    window.location.href = 'login.html';
                }

            } catch (error) {
                // 4. Se houver qualquer erro na leitura do token (ex: token inválido),
                //    limpa o armazenamento e volta para a tela de login por segurança.
                console.error('Falha ao processar o token:', error);
                localStorage.removeItem('authToken');
                window.location.href = 'login.html';
            }
        });
    </script>
</body>
</html>